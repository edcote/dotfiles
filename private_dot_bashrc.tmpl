# ~/.bashrc: executed by bash(1) for non-login shells.

# If not running interactively, don't do anything
case $- in
  *i*) ;;
    *) return;;
esac

# Shell Options
################

# Don't wait for job termination notification
set -o notify

# Don't use ^D to exit
set -o ignoreeof

# Use case-insensitive filename globbing
shopt -s nocaseglob

# When changing directory small typos can be ignored by bash
# for example, cd /vr/lgo/apaache would find /var/log/apache
shopt -s cdspell

# Replaces directory names with result of expansion on tab complete
shopt -s direxpand

# Check the window size after each command and, if necessary,
# update the values of LINES and COLUMNS.
shopt -s checkwinsize

# Match all files in subdirectories with **
shopt -s globstar

# History Options
##################

# Don't put duplicate lines in the history and clean up meaningless whitespace
export HISTCONTROL=ignoreboth

# Ignore some controlling instructions
export HISTIGNORE="[   ]*:&:bg:fg:exit"

# Whenever displaying the prompt, write the previous line to disk
export PROMPT_COMMAND="history -a"

# Apend to the history file, don't overwrite it
shopt -s histappend

# Store multiline shell commands
shopt -s cmdhist

# Allow larger .bash_history file
export HISTSIZE=1000
export HISTFILESIZE=100000

# Prompt Options
#################

# override terminal type set by tmux
case "${TERM}" in
  xterm*)
    export TERM="xterm-256color"
    ;;
esac

# enable color terminal
case "${TERM}" in
  *color)
    color_prompt="yes"
    ;;
esac

if [[ "${color_prompt}" == "yes" ]]; then
  PS1="${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ "
else
  PS1="${debian_chroot:+($debian_chroot)}\u@\h:\w\$ "
fi

unset color_prompt

# shorten paths in prompt
export PROMPT_DIRTRIM=4

# enable bash-git-prompt
{{ if not (contains "whi" .chezmoi.hostname) }}
export GIT_PROMPT_ONLY_IN_REPO=1
export GIT_PROMPT_THEME=Single_line_Minimalist_Ascii
export GIT_PROMPT_SHOW_UNTRACKED_FILES=no
source "${HOME}/.bash_git_prompt/gitprompt.sh"
{{ end }}

alias ls='ls --color=auto'

# enable programmable completion features (you don't need to enable
# this, if it's already enabled in /etc/bash.bashrc and /etc/profile
# sources /etc/bash.bashrc).
if ! shopt -oq posix; then
  if [[ -f /usr/share/bash-completion/bash_completion ]]; then
    . /usr/share/bash-completion/bash_completion
  elif [[ -f /etc/bash_completion ]]; then
    . /etc/bash_completion
  fi
fi

# Aliases
##########

alias df='df --human-readable'
alias du='du --human-readable'

alias l='less -r'
alias m='less -r'
alias more='less -r'
alias less='less -r'

alias h='history'
alias hgrep='history | grep -i'
alias cls='clear'

alias f='find'

alias g='egrep --ignore-case --color'
alias grep='egrep --color'
alias rg='rg --no-ignore'

alias vi='vim'
alias gi='gvim'

alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'

alias dir='ls'
alias ll='ls -l'
alias la='ls -A'
alias lr='ls -R'

alias gl='git log --pretty=format:"%h%x09%an%x09%ad%x09%s" --date=short'

# Adds directory to stack and print.
function p() {
  local d=${1:-.}
  pushd "${d}" >& /dev/null || return 1
  dirs -v
}
export -f p

# Removes directory from stack and print.
alias o='popd -n && dirs -v'

# Displays directory stack.
alias dirs='dirs -v'

# Clears directory stack.
alias popa='dirs -c'

# Environment Options
######################

export EDITOR=vim
export VISUAL=vim

export PATH="${PATH}:${HOME}/bin:${HOME}/go/bin"
{{ if (contains "google" .chezmoi.homeDir) }}
export PATH="${PATH}:${HOME}/hls_infra_tools/common/tools"
{{ if eq .chezmoi.osRelease.versionID "rodete" }}
gcertstatus --nocheck_ssh &>/dev/null || (echo "WARNING: LOAS2 certificate expired")
export P4DIFF=diff
{{ end }}
{{ end }}

[[ -f "${HOME}/.bash_aliases" ]]   && source "${HOME}/.bash_aliases"
[[ -f "${HOME}/.bash_functions" ]] && source "${HOME}/.bash_functions"
